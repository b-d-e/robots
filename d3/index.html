<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="viz.v1.1.2.min.js"></script>
  <script type="text/javascript" src="chordDiagram.js"></script>
</head>
<style>
body {
  font: 10px sans-serif;
}

svg text{
  text-anchor:middle;
  font-size:18px;
}
svg .values text{
  pointer-events:none;
  stroke-width: 0.5px;
}
.groups:hover{
  cursor:pointer;
  font-weight:bold;
}
/* modal for instruction popup */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
</style>
<body>
  <h1 id="main_title" style="text-align: center;">An interactive chord diagram to show internal migration between UK regions in the period July 2017 to June 2018.</h1>
  <div style="width: 100%;">
    <h2 id="source"></h2>
    <div style="float:right;">
      <h2>Region Key</h2>
      <p id="serieskey"></p>
    </div>
    <div id="vizdiv" style="float:left; width: 80%">
      <div style="overflow: hidden;">
        <button id="myBtn" style="float: right;">Instructions</button>
        <div id="col_selector" style="float:left;">
         <h3>Select the colour scheme for the chart:</h3>
         <select id="c_selector" onchange="updateColours()">
          <option value="a">Rainbow</option>
          <option value="b">Neutral</option>
          <option value="c">Dull</option>
          <option value="d">Red & Blue</option>
         </select>
       </div>
      </div>
       <div id="time_selector" style="float:left;">
        <h3>Select the time peiod for the chart:</h3>
        <select id="t_selector" onchange="updateTime()">
          <option value="18"">2017 ⟶ 2018</option>
          <option value="17"">2016 ⟶ 2017</option>
          <option value="16"">2015 ⟶ 2016</option>
          <option value="15"">2014 ⟶ 2015</option>
          <option value="14"">2013 ⟶ 2014</option>
          <option value="13"">2012 ⟶ 2013</option>
          <option value="12"">2011 ⟶ 2012</option>
        </select>
      </div>
       

      <script>
        const d = [[0,  8054, 13187,  4314, 3093, 4393, 5864, 6184, 2830, 1057, 3306],
          [8111,  0,  27267,  13147,  18071,  9780, 19338,  15022,  8844, 10873,  5348],
          [12388, 26101,  0,  23606,  10302,  11734,  15383,  13280,  6750, 2989, 3249],
          [3771,  12696,  23155,  0,  24518,  26984,  21901,  23511,  8362, 3399, 2222],
          [2764,  16744,  9975, 21898,  0,  11743,  24047,  20445,  16192,  9007, 2326],
          [3277,  7377, 8858, 18242,  9100, 0,  82606,  32493,  10901,  3236, 2842, 536],
          [7345,  18157,  15932,  18236,  19547,  43422,  0,  74646,  24675,  6799, 7152],
          [4535,  11648,  10553,  16982,  16108,  35535,  124751, 0,  40527,  7701, 4954],
          [2487,  9449, 6998, 10119,  18652,  16428,  30533,  57919,  0,  13181,  3161],
          [944, 10981,  2985, 3705, 10117,  4308, 6656, 11447,  16348,  0,  1312],
          [3324,  6284, 4653, 3144, 2906, 4117, 7869, 7341, 4139, 1651, 0]];
        const s = ["North East","North West","Yorkshire and The Humber","East Midlands","West Midlands","East","London","South East","South West","Wales","Scotland","Northern Ireland"]
        //const c = ["#003a30", "#007a65", "#fdf65a", "#fb763c", "#a30000","#ff8fc2","#73ffdf","#8f649f","#172856","#0e0b36","#565656","#2d2d2d"];
        const c = ["#FF0000", "#FF9000", "#FFF400", "#81FF00", "#009737", "#00FFED", "#00A5FF", "#0700FF", "#8800FF", "#FB00FF", "#FF9D9D", "#FFD9A9"];
        const vizname = "Comparison to d3.chord by user 'npashap'";
        const vizurl = "http://bl.ocks.org/npashap/2d76492981106691cdcf843d7e3f765a";
        const vizlicense = "GNU General Public License, version 3";
        const dataname = "the Office for National Statistics";
        const dataurl = "https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/migrationwithintheuk/datasets/matricesofinternalmigrationmovesbetweenlocalauthoritiesandregionsincludingthecountriesofwalesscotlandandnorthernireland";
        const datalicense = "Open Government Licence v3.0";
        
        const chart = new ChordDiagram(600,600,d,s,c,vizname, vizurl, vizlicense, dataname, dataurl, datalicense);
        //chart.draw();
        //chart.writeSources();
        </script>
       </div>
    </div>
 </div>
 <div style="clear:both"></div>
 
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <h1 id="modalA">Welcome!</h1>
    <h2 id="modalB">Here's how to use this chord diagram:</h2>
    <h3>
    <ul>
      <li>Each colour represents a different region of the country. On the right hand side of the screen is a helpful key so you can tell which is which.</li>
      <li>If you'd rather a different colour scheme (although rainbow is probably best for distinguishing regions), then you can select one using the drop down menu at the left of the screen - the chart and key will update to whichever you choose.</li>
      <li>The chord diagram shows flows of people from region to region. By default, the size of incoming lines in proportion to the coloured block shows the proportion of people who <i>come into that region to another region</i></i></li>
      <li>To see the proportions of people <i>going out of that region to another region</i> in respect to the total regional outgoing amount, simply hover your mouse over a coloured block in the chart. It will focus in to show you the migation data for people going out of that region.</li>
      <li>This page lets you see migration data for any given year from 2011 through to 2018 - to change the time period you are visualising, simply select it from the drop down menu on the left of the screen.</li>
      <li>Click the 'instructions' button at any time to make this popup reappear.</li>
    </ul>
  </h3>
  </div>

</div>

<script>
// Get the modal
var modal = document.getElementById("myModal");
modal.style.display = "block";
// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
  document.getElementById("modalA").innerHTML = "Need some help?";
  document.getElementById("modalB").innerHTML = "No worries! Here's how to use this chord diagram:";
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>
</body>
